Got it ğŸ‘ â€” hereâ€™s your revised textual prompt with all occurrences of â€œCreditAgreementâ€ replaced by â€œCreditFacilitiesâ€.


---

ğŸ§© Textual Representation (Updated Prompt)

Flow Name:
LPD Risk Signal Administration â€” Data Design & Event Generation Flow


---

1ï¸âƒ£ Kafka Consumer Layer

Step: Kafka Consumer reads messages from all the subscribed topics.

Action: Passes each message to the Service layer for validation.



---

2ï¸âƒ£ Message Validation Layer

Step: Service validates the incoming JSON message.

Condition:

If JSON is invalid â†’ Log error â€œInvalid JSON formatâ€ and read next message.

If JSON is valid â†’ Proceed to entity validation.




---

3ï¸âƒ£ Entity Validation Layer

Condition: Does the JSON contain a valid CreditFacilities entity?

If No â†’ Log â€œCreditFacilities entity missingâ€ and read next message.

If Yes â†’ Proceed to check â€œCF entities.â€




---

4ï¸âƒ£ CF Entities Validation

Check: Does CF entity have a globalFacilityId?

If No â†’ Log â€œglobalFacilityId missingâ€ and read next message.

If Yes â†’

Check in all other entities where parentFacility = creditFacilityIdentifier of CF entities.

Verify if globalFacilityId is available (non-null) in any of the entities.

If still not found, check for all CurrentAccount entities having a valid globalFacilityId.

If found â†’ proceed.

If not found â†’ Log â€œglobalFacilityId unavailableâ€ and read next message.





---

5ï¸âƒ£ Contract Admin / Credit Facility Mapping

Retrieve globalFacilityId in LPD data map â†’
ContractAdmin â†’ CreditFacility â†’ AlternativeAgreement â†’ ValueId.



---

6ï¸âƒ£ Alternative Agreement Validation

Condition: Is AlternativeAgreementValueId â€œEFFECTIVE / ACTIVEâ€?

If No â†’ Log â€œFacilityAlternateIdentifier not effective in CRMSâ€ and read next message.

If Yes â†’ Proceed to field-level validations.




---

7ï¸âƒ£ Mandatory Field Validations

Perform checks for:

originalLifetimePD being null

residualLifetimePD being null

ClientSegmentLevel being null

lpDeteriorationFlag being absent or invalid (not in allowed values Y/N)


If any error â†’ Log error and read next message.

If all valid â†’ Proceed to update risk signal.



---

8ï¸âƒ£ Insert or Update LPD Risk Signal

Action: Insert or update record in LPDRiskSignal table.



---

9ï¸âƒ£ Party Identification & Event Generation

Step:

Call Contract API to identify PartyId using contract details.

Generate event for the identified PartyId.

Send the single found PartyId as output for event generation.




---

ğŸ”Ÿ Generate LPD Event

Final Step: Generate the corresponding LPD Event based on validated data and identified party.



---

âš™ï¸ Error Handling Summary

Whenever a validation fails:

Log the corresponding error message (e.g., Invalid JSON, Missing Entity, Missing Field).

Skip current message and move to the next Kafka record.



---

Would you like me to now convert this version into a visual Mermaid flowchart or keep it as textual format only?